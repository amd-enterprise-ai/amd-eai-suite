<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd
                   http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

<changeSet author="clydehoang1" id="update-secrets-and-project-secrets-indexes">
    <!-- Standardize index names -->
    <dropIndex indexName="ix_project_storage_storage_id" tableName="project_storages"/>
    <dropIndex indexName="ix_project_storages_configmap_project_storage_id" tableName="project_storages_configmap"/>

	<!-- ========== storages ========== -->
    <createIndex indexName="ix_storages_secret_id" tableName="storages">
      <column name="secret_id"/>
    </createIndex>
    <createIndex indexName="ix_storages_org_secret" tableName="storages">
      <column name="organization_id"/>
      <column name="secret_id"/>
    </createIndex>

    <!-- ProjectStorages -->
    <createIndex indexName="ix_project_storages_project_id" tableName="project_storages">
      <column name="project_id"/>
    </createIndex>
    <createIndex indexName="ix_project_storages_storage_id" tableName="project_storages">
      <column name="storage_id"/>
    </createIndex>

    <!-- ProjectStoragesConfigmap -->
    <createIndex indexName="ix_ps_configmap_project_storage_id" tableName="project_storages_configmap">
      <column name="project_storage_id"/>
    </createIndex>

    <!-- secrets -->
    <createIndex indexName="ix_secrets_organization_id" tableName="secrets">
      <column name="organization_id"/>
    </createIndex>

    <!-- ProjectSecrets -->
    <createIndex indexName="ix_project_secret_project_id" tableName="project_secrets">
      <column name="project_id"/>
    </createIndex>

</changeSet>
</databaseChangeLog>
